# 御姐撒娇插件

这是一个简单的微信机器人插件，可以随机返回一条御姐撒娇语音。

## 功能介绍

- 当用户发送包含触发词的消息时，插件会从 API 获取一条随机御姐撒娇语音并发送
- 支持自定义触发词
- 支持使用 ffmpeg 处理语音文件，提高兼容性
- 支持 HTTP 代理配置
- 实现了阻塞机制，成功发送语音后会阻止后续插件处理同一消息

## 安装方法

1. 将插件文件夹放入`plugins`目录
2. 确保系统已安装 ffmpeg（可选，但强烈推荐）
3. 重启机器人

## 配置说明

配置文件位于`plugins/YujieSajiao/config.toml`，包含以下配置项：

```toml
[YujieSajiao]
# 插件开关
enable = true

# API地址
api_url = "https://api.317ak.com/API/yy/yjsj.php"

# 触发词列表
trigger_words = [
    "御姐撒娇",
    "御姐语音",
    "来点御姐",
    "撒个娇"
]

# 是否使用ffmpeg处理语音文件
# 如果设置为false，将直接使用原始文件
use_ffmpeg = true

# HTTP代理（可选）
# http_proxy = "http://127.0.0.1:7890"
```

## 使用方法

在聊天中发送包含触发词的消息，例如：

- "来点御姐撒娇"
- "御姐语音"
- "来点御姐"
- "撒个娇"

机器人会回复一条随机御姐撒娇语音。

## API 说明

本插件使用的 API 来自：https://api.317ak.com/API/yy/yjsj.php

- 请求方式：GET
- 返回格式：MP3
- 无需参数

## 注意事项

- 请确保系统已安装 ffmpeg，这对于处理语音文件非常重要
- 如果无法安装 ffmpeg，可以在配置文件中设置`use_ffmpeg = false`
- 请确保网络环境能够访问 API
- 如果需要使用代理，请在配置文件中设置`http_proxy`
- 语音文件可能较大，请确保网络环境良好
- 插件会将下载的语音文件保存到`plugins/YujieSajiao/cache`目录，并在发送后自动删除

## 阻塞机制说明

本插件实现了消息处理的阻塞机制，具体行为如下：

- 当插件成功发送御姐撒娇语音后，会返回`False`，阻止后续插件处理同一消息
- 在以下情况下，插件会返回`True`，允许后续插件继续处理消息：
  - 插件未启用
  - 消息不包含触发词
  - 获取语音失败
  - 处理过程中出现异常

这种设计确保了当插件成功处理消息时，不会被其他插件干扰，而在处理失败时，允许其他插件有机会处理消息。

## 故障排除

如果插件无法正常工作，请检查：

1. 确保系统已安装 ffmpeg，可以在命令行运行`ffmpeg -version`检查
2. 确保网络可以访问 API
3. 查看日志文件，了解具体错误信息
4. 如果出现 ffmpeg 相关错误，可以尝试在配置文件中设置`use_ffmpeg = false`
